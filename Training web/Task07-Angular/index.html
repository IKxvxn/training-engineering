<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <script src="handlebars-v4.7.7.js"></script>
    <link
      href="http://fonts.googleapis.com/css?family=Roboto"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="https://file.myfontastic.com/ajCoLUAnLF3qkVEVqw8ujY/icons.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <header class="header">
      <img src="./images/logo.svg" alt="logo" />
      <label class="header__label icon-bars" for="toggle"></label>
      <input type="checkbox" id="toggle" />
      <nav class="header__nav">
        <a class="header__item">Directorio de agentes</a>
        <a class="header__item">Contacto</a>
        <a class="header__item">Ingresar</a>
      </nav>
    </header>
    <main class="main">
      <div class="main__img-container">
        <picture>
          <source srcset="./images/banner.png" media="(min-width: 768px)" />
          <img
            class="main__img main__img--cover"
            src="./images/banner-mobile.png"
            alt="page-banner"
          />
        </picture>
      </div>
      <div class="main__welcome-container">
        <h2 class="main__title">Los mejores agentes de seguridad</h2>
        <div class="main__search-container">
          <input
            id = "companies-search-input"
            class="main__search-input"
            placeholder="Buscar por Ubicación"
            type="search"
          />
          <button class="main__search-btn icon-search" type="button" onclick="filterCompaniesList()"/>
        </div>
      </div>
      <ul id="items-container" class="main__grid-list main__grid-list--no-bullet"> 
    </main>
    <footer class="footer">
      <p class="footer__text">
        Desarrollado por Akurey.com | Todos los derechos reservados.
      </p>
      <a class="footer__link">Términos y condiciones</a>
    </footer>
    <script id="item-template" type="text/x-handlebars-template">
      {{#each this}}
        <li class="main__item">
          <div class="main__title-container">
            <h3 class="main__item-title">{{name}}</h3>
            {{#if isCertified}}
              <img src="./images/certified.png" />
            {{/if}}
           </div>
           <hr />
           <img class="main__item-img" src={{image}} alt="Bodyguards" />
          <p class="main__item-description">{{description}}</p>
          <br />
          <div class="main__purchase-container">
             <p class="main__item-side-text">Desde ${{rate}} {{hours}} horas</p>
             <button class="main__item-btn main__item-btn--dark" type="button">
               Contratar
             </button>
           </div>
        </li>
      {{/each}}
    </script>
    <script type="text/javascript">
      let element = document.getElementById("item-template").innerHTML;
      let template = Handlebars.compile(element);

      fetch("https://my-json-server.typicode.com/IKxvxn/fake-server/companies", {method:'GET', headers: { 'Content-Type': 'application/json' }})
      .then(r => r.json())
      .then(data => {
        let final = template(data);
        document.getElementById("items-container").innerHTML += final;
      })
      .catch(e => console.error(e))

      document.getElementById("companies-search-input").onkeydown = event => {
        if (event.keyCode == 13) {
          filterCompaniesList();
        }
      }

      function filterCompaniesList() {
        value = document.getElementById("companies-search-input").value.toLowerCase()
        items = document.getElementsByClassName("main__item")
        
        for(let item of items) {
          if(item.childNodes[1].childNodes[1].innerHTML.toLowerCase().includes(value)) {
            item.classList.remove("main__item--hidden")
          }
          else {
            item.classList.add("main__item--hidden")
          }
        }
      }
    </script>
  </body>
</html>
